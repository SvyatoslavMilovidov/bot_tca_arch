# üéØ –ü–∞–∫–µ—Ç `handler`

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞](#–æ–ø–∏—Å–∞–Ω–∏–µ-–ø–∞–∫–µ—Ç–∞)
2. [–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–í–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä](#–≤–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä)
4. [–ß–µ–∫-–ª–∏—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤](#—á–µ–∫-–ª–∏—Å—Ç-–¥–æ–±–∞–≤–ª–µ–Ω–∏—è-–≤–∏–¥–∂–µ—Ç–∞)

---

## –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞–∫–µ—Ç–∞

### üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü–∞–∫–µ—Ç `handler` —Å–æ–¥–µ—Ä–∂–∏—Ç **–≤–∏–¥–∂–µ—Ç—ã-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—ã**, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–±–∏—Ä–∞—é—Ç UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `node/` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telegram.

### üí° –ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

**–í–∏–¥–∂–µ—Ç = –û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**

–í–∏–¥–∂–µ—Ç –≤ `handler/` –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –Ω–∞–ø—Ä—è–º—É—é. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –æ–Ω:
1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `node/` (Trigger, Code, Answer)
2. **–°–æ–∑–¥–∞–µ—Ç** –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä Answer-–æ–≤
3. **–û—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç** –≤—ã–∑–æ–≤—ã: Trigger ‚Üí Code ‚Üí Answer
4. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** –≤ —Ä–æ—É—Ç–µ—Ä–µ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  handler/start_command_widget.py   ‚îÇ  ‚Üê –í–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ from node.control.trigger import   ‚îÇ
‚îÇ from node.control.code import      ‚îÇ
‚îÇ from node.control.answer import    ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ ANSWER_REGISTRY = {               ‚îÇ
‚îÇ   "new_user": NewUserAnswer(),    ‚îÇ
‚îÇ   "vacancy_list": VacancyListAnswer() ‚îÇ
‚îÇ }                                  ‚îÇ
‚îÇ                                    ‚îÇ
‚îÇ @router.message(Command("start")) ‚îÇ
‚îÇ async def handle_start(...):      ‚îÇ
‚îÇ   trigger_data = trigger.run()    ‚îÇ
‚îÇ   code_result = code.run()        ‚îÇ
‚îÇ   answer.run()                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### üè∑Ô∏è –°–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–æ–≤
–í–∏–¥–∂–µ—Ç—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ **—Ç–µ–≥–∞–º** - –ª–æ–≥–∏—á–µ—Å–∫–∏–º –±–ª–æ–∫–∞–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

**–ü—Ä–∏–º–µ—Ä—ã —Ç–µ–≥–æ–≤:**
- `control` - —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã (/start, /settings)
- `vacancy` - —Ä–∞–±–æ—Ç–∞ —Å –≤–∞–∫–∞–Ω—Å–∏—è–º–∏
- `payment` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- `interview` - –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤—å—é

### üìÇ –í–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞
–í–Ω—É—Ç—Ä–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Ç–µ–≥–∞ –≤ `handler/` –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è **–≤–ª–æ–∂–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π** –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤–∏–¥–∂–µ—Ç–æ–≤ (–ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º, —ç—Ç–∞–ø–∞–º, –ø–æ–¥—Å–µ–∫—Ü–∏—è–º –∏ —Ç.–¥.). –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—è –µ–≥–æ –±–æ–ª—å—à–∏–º —á–∏—Å–ª–æ–º —Ñ–∞–π–ª–æ–≤ –Ω–∞ –æ–¥–Ω–æ–º —É—Ä–æ–≤–Ω–µ.

–ü—Ä–∏–º–µ—Ä –¥–æ–ø—É—Å—Ç–∏–º–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:

```
handler/
‚îî‚îÄ‚îÄ v1/
    ‚îî‚îÄ‚îÄ user/
        ‚îî‚îÄ‚îÄ vacancy/
            ‚îú‚îÄ‚îÄ __init__.py
            ‚îú‚îÄ‚îÄ router.py
            ‚îú‚îÄ‚îÄ list/
            ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
            ‚îÇ   ‚îî‚îÄ‚îÄ list_widget.py
            ‚îú‚îÄ‚îÄ detail/
            ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
            ‚îÇ   ‚îî‚îÄ‚îÄ detail_widget.py
            ‚îî‚îÄ‚îÄ creation/
                ‚îú‚îÄ‚îÄ __init__.py
                ‚îú‚îÄ‚îÄ create_widget.py
                ‚îî‚îÄ‚îÄ confirm_widget.py
```

–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –í–∏–¥–∂–µ—Ç—ã –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –∏–º–µ–Ω—É—é—Ç—Å—è `{name}_widget.py`, –∞ –∏–º–ø–æ—Ä—Ç –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `router.py` —Ç–µ–≥–∞.
- –í `handler/v1/user/{tag}/__init__.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤–∏–¥–∂–µ—Ç—ã –∏–∑ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –ª–∏–±–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —è–≤–Ω—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ `router.py`.
- –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ **–ø–æ–ª–Ω—ã–π –ø—É—Ç—å** –¥–æ –≤–∏–¥–∂–µ—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏–∏ —Å–≤—è–∑–µ–π (—Å–º. —Ä–∞–∑–¥–µ–ª –Ω–∏–∂–µ ¬´–î–æ—Å—Ç—É–ø–µ–Ω –∏–∑/–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤¬ª).

### üìÅ –ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç
- **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø–æ —Ç–µ–≥–∞–º:** –ö–∞–∂–¥—ã–π —Ç–µ–≥ = –æ—Ç–¥–µ–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
- **–í–∏–¥–∂–µ—Ç—ã-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—ã:** –ö–∞–∂–¥—ã–π –≤–∏–¥–∂–µ—Ç = –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª `{name}_widget.py`
- **–†–æ—É—Ç–µ—Ä—ã:** –§–∞–π–ª—ã `router.py` –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤

---

## –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–∫–µ—Ç–∞

```
handler/
‚îú‚îÄ‚îÄ v1/
‚îÇ   ‚îú‚îÄ‚îÄ user/                          # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –≤–∏–¥–∂–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ router.py                  # –†–æ—É—Ç–µ—Ä—ã –ø–æ —Ç–µ–≥–∞–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ control/                   # –¢–µ–≥: control
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ start_command_widget.py    # –í–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings_command_widget.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ vacancy/                   # –¢–µ–≥: vacancy
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ list_widget.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ detail_widget.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/                   # –¢–µ–≥: payment
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ select_package_widget.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interview/                 # –¢–µ–≥: interview
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ start_interview_widget.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ admin/                         # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–∏–¥–∂–µ—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ router.py
‚îÇ       ‚îî‚îÄ‚îÄ management/
‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ           ‚îî‚îÄ‚îÄ user_list_widget.py
‚îÇ
‚îú‚îÄ‚îÄ include_router.py                  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ middleware
‚îî‚îÄ‚îÄ middleware/                        # Middleware –¥–ª—è —Ö–µ–Ω–¥–ª–µ—Ä–æ–≤
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ register_middleware.py
    ‚îú‚îÄ‚îÄ large_middleware.py
    ‚îî‚îÄ‚îÄ error_middleware.py
```

---

## –í–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

### üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ –≤–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä?

–í–∏–¥–∂–µ—Ç-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä - —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è-—Ö–µ–Ω–¥–ª–µ—Ä, –∫–æ—Ç–æ—Ä–∞—è:
1. **–ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `node/{tag}/`
2. **–°–æ–∑–¥–∞–µ—Ç** –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä Answer-–æ–≤ (–º–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí –∫–ª–∞—Å—Å)
3. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç** Trigger ‚Üí Code ‚Üí Answer
4. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è** –≤ —Ä–æ—É—Ç–µ—Ä–µ —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä (`@router.message()` –∏–ª–∏ `@router.callback_query()`)

### üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```python
"""
–í–∏–¥–∂–µ—Ç: {–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞}.

{–û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –≤–∏–¥–∂–µ—Ç–∞}.
"""

from aiogram.types import Message, CallbackQuery
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command

from handler.v1.user.router import {tag}_router
from core.vocab import COMMANDS

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ node
from node.{tag}.trigger.{action}_trigger import {Action}Trigger
from node.{tag}.code.{action}_code import {Action}Code
from node.{tag}.answer.{state1}_answer import {State1}Answer
from node.{tag}.answer.{state2}_answer import {State2}Answer

# –†–µ–µ—Å—Ç—Ä Answer-–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
ANSWER_REGISTRY = {
    "state1": {State1}Answer(),
    "state2": {State2}Answer()
}

@{tag}_router.message(Command(COMMANDS["{command}"]))
async def handle_{widget_name}(
    event: Message | CallbackQuery,
    state: FSMContext,
        user_lang: str,
    **kwargs
    ):
        """
    –ì–ª–∞–≤–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ {–Ω–∞–∑–≤–∞–Ω–∏–µ}.
    
    –í—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {—Å–ø–∏—Å–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π}
    –í—ã—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {—Å–ø–∏—Å–æ–∫ —Å–æ—Å—Ç–æ—è–Ω–∏–π}
    
    FSM –Ω–∞ –≤—Ö–æ–¥–µ:
    - {field1}: {type} ({required/optional}) - {–æ–ø–∏—Å–∞–Ω–∏–µ}
    
    FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Code –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç):
    - {field2}: {type} ({required/optional}) - {–æ–ø–∏—Å–∞–Ω–∏–µ}
    
    FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Answer –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç):
    - {field3}: {type} ({required/optional}) - {–æ–ø–∏—Å–∞–Ω–∏–µ} ({–≤ –∫–∞–∫–æ–º Answer})
    
    –í–æ–∑–º–æ–∂–Ω—ã–µ Answer:
    - {answer_name1} ({AnswerClass1}) - –µ—Å–ª–∏ {—É—Å–ª–æ–≤–∏–µ}
      –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: {—á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç}
      –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: node/{tag}/answer/{answer}_answer.py
    
    - {answer_name2} ({AnswerClass2}) - –µ—Å–ª–∏ {—É—Å–ª–æ–≤–∏–µ}
      –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: {—á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç}
      –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: node/{tag}/answer/{answer}_answer.py
    
    –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
    1. {Action}Trigger - {—á—Ç–æ –¥–µ–ª–∞–µ—Ç}
    2. {Action}Code - {—á—Ç–æ –¥–µ–ª–∞–µ—Ç}
    3. Answer –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ - {—á—Ç–æ –¥–µ–ª–∞–µ—Ç}
    """
    
    # –®–∞–≥ 1: Trigger (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
    trigger = {Action}Trigger()
    trigger_data = await trigger.run(event, state)
    
    # –®–∞–≥ 2: Code (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
    code = {Action}Code()
    code_result = await code.run(trigger_data, state, **kwargs)
    
    # –®–∞–≥ 3: Answer (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞)
    answer_name = code_result["answer_name"]
    answer = ANSWER_REGISTRY[answer_name]
    await answer.run(
        event=event,
        user_lang=user_lang,
        data=code_result["data"]
    )
```

### üìñ –ü—Ä–∞–≤–∏–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –≤ docstring —Ö–µ–Ω–¥–ª–µ—Ä–∞:**

1. **–í—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –∫–∞–∫–∏–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–∏–¥–∂–µ—Ç
2. **–í—ã—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** - –≤ –∫–∞–∫–∏–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç
3. **FSM –Ω–∞ –≤—Ö–æ–¥–µ** - –∫–∞–∫–∏–µ –ø–æ–ª—è FSM –Ω—É–∂–Ω—ã (required/optional)
4. **FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Code)** - –∫–∞–∫–∏–µ –ø–æ–ª—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç Code
5. **FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Answer)** - –∫–∞–∫–∏–µ –ø–æ–ª—è –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∫–∞–∂–¥—ã–π Answer
6. **–í–æ–∑–º–æ–∂–Ω—ã–µ Answer** - —Å–ø–∏—Å–æ–∫ Answer —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
   - –ù–∞–∑–≤–∞–Ω–∏–µ Answer –≤ —Ä–µ–µ—Å—Ç—Ä–µ
   - –ö–ª–∞—Å—Å Answer
   - –£—Å–ª–æ–≤–∏–µ –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
   - –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
   - –ü—É—Ç—å –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É –≤ node/
7. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### üîó –°–≤—è–∑–∏ –≤ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–º –≤–∏–¥–µ
–í docstring –≤–∏–¥–∂–µ—Ç–∞ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –±–ª–æ–∫, —Ñ–∏–∫—Å–∏—Ä—É—é—â–∏–π –≤—Ö–æ–¥—è—â–∏–µ –∏ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–≤—è–∑–∏ –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ø–æ–ª—è–º `from`/`to` –≤ —Å—Ö–µ–º–µ:

```
–î–æ—Å—Ç—É–ø–µ–Ω –∏–∑:
1. widget_name (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
   - –ò–∑ –∫–∞–∫–æ–≥–æ state (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
   - –ò–∑ –∫–∞–∫–æ–≥–æ answer (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
2. ...

–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤:
1. widget_name (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
   - –í –∫–∞–∫–æ–º state (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
   - –ò–∑ –∫–∞–∫–æ–≥–æ answer (+ –ø—É—Ç—å –¥–æ –Ω–µ–≥–æ)
2. ...
```

–ü–æ—è—Å–Ω–µ–Ω–∏—è:
- ¬´–ò–∑ –∫–∞–∫–æ–≥–æ state¬ª ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥.
- ¬´–ò–∑ –∫–∞–∫–æ–≥–æ answer¬ª ‚Äî Answer –∏—Å—Ç–æ—á–Ω–∏–∫–∞, –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ—Ö–æ–¥.
- ¬´–í –∫–∞–∫–æ–º state¬ª ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM, –∫–æ—Ç–æ—Ä–æ–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ü–µ–ª–µ–≤—ã–º Answer —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–¥–∂–µ—Ç–∞.

### üì± –ü—Ä–∏–º–µ—Ä –≤–∏–¥–∂–µ—Ç–∞ –∫–æ–º–∞–Ω–¥—ã /start

**–§–∞–π–ª:** `handler/v1/user/control/start_command_widget.py`

```python
"""
–í–∏–¥–∂–µ—Ç: –ö–æ–º–∞–Ω–¥–∞ /start.

–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –±–æ—Ç–∞. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—ã–±–æ—Ä —è–∑—ã–∫–∞,
–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º - —Å–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π.

–î–æ—Å—Ç—É–ø–µ–Ω –∏–∑:
1. entry (handler/v1/user/control/start_command_widget.py)
   - –ò–∑ –∫–∞–∫–æ–≥–æ state: –ª—é–±–æ–µ (*)
   - –ò–∑ –∫–∞–∫–æ–≥–æ answer: ‚Äî (–∫–æ–º–∞–Ω–¥–∞)

–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –≤:
1. registration (handler/v1/user/onboarding/registration_widget.py)
   - –í –∫–∞–∫–æ–º state: state/onboarding.py::registration_started
   - –ò–∑ –∫–∞–∫–æ–≥–æ answer: new_user (node/control/answer/new_user_answer.py)
2. vacancy/list (handler/v1/user/vacancy/list_widget.py)
   - –í –∫–∞–∫–æ–º state: state/vacancy.py::vacancy_list
   - –ò–∑ –∫–∞–∫–æ–≥–æ answer: vacancy_list (node/control/answer/vacancy_list_answer.py)
"""

from aiogram.types import Message
from aiogram.fsm.context import FSMContext
from aiogram.filters import Command

from handler.v1.user.router import control_router
from core.vocab import COMMANDS

# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ node
from node.control.trigger.start_command_trigger import StartCommandTrigger
from node.control.code.start_command_code import StartCommandCode
from node.control.answer.new_user_answer import NewUserAnswer
from node.control.answer.vacancy_list_answer import VacancyListAnswer

# –†–µ–µ—Å—Ç—Ä Answer-–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞
ANSWER_REGISTRY = {
    "new_user": NewUserAnswer(),
    "vacancy_list": VacancyListAnswer()
}

@control_router.message(Command(COMMANDS["start"]))
async def handle_start_command(
    message: Message,
    state: FSMContext,
    user_lang: str,
    is_new_user: bool
):
    """
    –ì–ª–∞–≤–Ω—ã–π —Ö–µ–Ω–¥–ª–µ—Ä –∫–æ–º–∞–Ω–¥—ã /start.
    
    –í—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: –ª—é–±–æ–µ (*)
    –í—ã—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è: None (idle)
    
    FSM –Ω–∞ –≤—Ö–æ–¥–µ:
    - –Ω–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
    
    FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Code –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç):
    - –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π (FSM –æ—á–∏—â–∞–µ—Ç—Å—è –≤ Trigger)
    
    FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Answer –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç):
    - –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π
    
    –í–æ–∑–º–æ–∂–Ω—ã–µ Answer:
    - new_user (NewUserAnswer) - –µ—Å–ª–∏ is_new_user=True
      –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: –≤—ã–±–æ—Ä —è–∑—ã–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: node/control/answer/new_user_answer.py
    
    - vacancy_list (VacancyListAnswer) - –µ—Å–ª–∏ is_new_user=False
      –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç: —Å–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
      –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: node/control/answer/vacancy_list_answer.py
    
    –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
    1. StartCommandTrigger - –æ—á–∏—Å—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ FSM
    2. StartCommandCode - –ø—Ä–æ–≤–µ—Ä–∫–∞ is_new_user –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–π
    3. Answer –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
    """
    
    # –®–∞–≥ 1: Trigger (–≤–∏–∑—É–∞–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
    trigger = StartCommandTrigger()
    trigger_data = await trigger.run(message, state)
    
    # –®–∞–≥ 2: Code (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
    code = StartCommandCode()
    code_result = await code.run(trigger_data, state, is_new_user)
    
    # –®–∞–≥ 3: Answer (–æ—Ç—Ä–∏—Å–æ–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞)
    answer_name = code_result["answer_name"]
    answer = ANSWER_REGISTRY[answer_name]
    await answer.run(
        message=message,
        user_lang=user_lang,
        data=code_result["data"]
    )
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `node/control/`
2. –°–æ–∑–¥–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä Answer-–æ–≤
3. –í —Ö–µ–Ω–¥–ª–µ—Ä–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ–º Trigger ‚Üí Code ‚Üí Answer
4. –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@control_router.message()`

**–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
- `VacancyListAnswer` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –¥—Ä—É–≥–∏—Ö –≤–∏–¥–∂–µ—Ç–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `/vacancy`)
- `StartCommandTrigger` –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≥–¥–µ –Ω—É–∂–Ω–∞ —Ç–∞–∫–∞—è –∂–µ –æ—á–∏—Å—Ç–∫–∞
- –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

---

## –ß–µ–∫-–ª–∏—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∂–µ—Ç–∞

### ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

#### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ node/

- [ ] **–°–æ–∑–¥–∞—Ç—å Trigger** –≤ `node/{tag}/trigger/{action}_trigger.py`
  - –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: [node.md](node.md#trigger---–≤–∏–∑—É–∞–ª—å–Ω—ã–µ-–æ–ø–µ—Ä–∞—Ü–∏–∏)
  - –°–ª–µ–¥–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω—É –∏ –ø—Ä–∞–≤–∏–ª–∞–º –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  
- [ ] **–°–æ–∑–¥–∞—Ç—å Code** –≤ `node/{tag}/code/{action}_code.py`
  - –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: [node.md](node.md#code---–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
  - –û–ø–∏—Å–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø–æ—à–∞–≥–æ–≤–æ
  - –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
  - –û–ø–∏—Å–∞—Ç—å –≤—Å–µ —É—Å–ª–æ–≤–∏—è —Ä–æ—É—Ç–∏–Ω–≥–∞
  
- [ ] **–°–æ–∑–¥–∞—Ç—å Answer-—ã** –≤ `node/{tag}/answer/{state}_answer.py`
  - –°–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: [node.md](node.md#answer---–æ—Ç—Ä–∏—Å–æ–≤–∫–∞-—ç–∫—Ä–∞–Ω–æ–≤)
  - –û–¥–∏–Ω Answer = –æ–¥–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞
  - –£–∫–∞–∑–∞—Ç—å –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

#### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

- [ ] **–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–≥** - –∫ –∫–∞–∫–æ–º—É —Ç–µ–≥—É –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –≤–∏–¥–∂–µ—Ç
- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** `handler/v1/user/{tag}/`
- [ ] **–ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ—Ç** - —Å–æ–∑–¥–∞—Ç—å `handler/v1/user/{tag}/`
- [ ] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –≤–∏–¥–∂–µ—Ç–∞** `{name}_widget.py`
- [ ] **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** –∏–∑ `node/{tag}/`
- [ ] **–°–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä Answer-–æ–≤** `ANSWER_REGISTRY = {...}`
- [ ] **–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é-—Ö–µ–Ω–¥–ª–µ—Ä** `async def handle_{name}(...)`
- [ ] **–í docstring —Ö–µ–Ω–¥–ª–µ—Ä–∞ —É–∫–∞–∑–∞—Ç—å:**
  - [ ] –í—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
  - [ ] –í—ã—Ö–æ–¥–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM  
  - [ ] FSM –Ω–∞ –≤—Ö–æ–¥–µ (required/optional)
  - [ ] FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Code)
  - [ ] FSM –Ω–∞ –≤—ã—Ö–æ–¥–µ (Answer)
  - [ ] **–í–æ–∑–º–æ–∂–Ω—ã–µ Answer** —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
    - –ù–∞–∑–≤–∞–Ω–∏–µ Answer
    - –ö–ª–∞—Å—Å Answer
    - –£—Å–ª–æ–≤–∏–µ –∫–æ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è
    - –ß—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç
    - –ü—É—Ç—å –∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É
  - [ ] –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (Trigger ‚Üí Code ‚Üí Answer)
- [ ] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã:**
  - [ ] Trigger ‚Üí –ø–æ–ª—É—á–∏—Ç—å trigger_data
  - [ ] Code ‚Üí –ø–æ–ª—É—á–∏—Ç—å code_result —Å answer_name
  - [ ] Answer ‚Üí –≤—ã–∑–≤–∞—Ç—å –Ω—É–∂–Ω—ã–π Answer –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
- [ ] **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ö–µ–Ω–¥–ª–µ—Ä** —á–µ—Ä–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@router.message()` –∏–ª–∏ `@router.callback_query()`

#### –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–∞ (–µ—Å–ª–∏ —Ç–µ–≥ –Ω–æ–≤—ã–π)

- [ ] **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å router.py** - –µ—Å—Ç—å –ª–∏ —Ä–æ—É—Ç–µ—Ä –¥–ª—è —Ç–µ–≥–∞
- [ ] **–ï—Å–ª–∏ –Ω–µ—Ç** - —Å–æ–∑–¥–∞—Ç—å —Ä–æ—É—Ç–µ—Ä –≤ `handler/v1/user/router.py`:
```python
  {tag}_router = Router()
  ```
- [ ] **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç** –≤ `handler/v1/user/{tag}/__init__.py`
- [ ] **–ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–æ—É—Ç–µ—Ä** –≤ `handler/include_router.py`:
```python
  from handler.v1.user import {tag}_router
  dp.include_router({tag}_router)
  ```

### üìã –®–∞–±–ª–æ–Ω –≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–°–º. —Ä–∞–∑–¥–µ–ª [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞](#üìù-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–≤–∏–¥–∂–µ—Ç–∞-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞) –≤—ã—à–µ.

---

## üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –∏ middleware

### –†–æ—É—Ç–µ—Ä—ã

**1. –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã –≤ `handler/v1/user/router.py`:**

```python
"""–†–æ—É—Ç–µ—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤–∏–¥–∂–µ—Ç–æ–≤."""
from aiogram import Router

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–≥–∞
control_router = Router()
vacancy_router = Router()
payment_router = Router()
interview_router = Router()
```

**2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä –≤ –≤–∏–¥–∂–µ—Ç–µ:**

```python
from handler.v1.user.router import control_router

@control_router.message(Command("start"))
async def handle_start_command(...):
    """–í–∏–¥–∂–µ—Ç –∫–æ–º–∞–Ω–¥—ã /start"""
```

**3. –ü–æ–¥–∫–ª—é—á–∞–µ–º —Ä–æ—É—Ç–µ—Ä –≤ `handler/include_router.py`:**

```python
from handler.v1.user import (
    control_router,
    vacancy_router,
    payment_router,
    interview_router,
)
from core import dp

dp.include_router(control_router)
dp.include_router(vacancy_router)
dp.include_router(payment_router)
dp.include_router(interview_router)
```

### Middleware

**–°–æ–∑–¥–∞–µ–º middleware –≤ `handler/middleware/`:**

–ö–∞–∂–¥—ã–π middleware –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º:
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ** - –¥–ª—è —á–µ–≥–æ –Ω—É–∂–µ–Ω middleware
- **–ß—Ç–æ –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ—Ç** - –∫–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è/–¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
- **–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ü—Ä–∏–º–µ—Ä middleware:**

```python
"""
Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ –ø–µ—Ä–µ–¥ 
–æ–±—Ä–∞–±–æ—Ç–∫–æ–π –µ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤.

–ß—Ç–æ –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ—Ç: –í—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∫–æ–ª–±–µ–∫–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 
- –ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
- –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
"""

from aiogram import BaseMiddleware
from aiogram.types import Message, CallbackQuery

class AuthMiddleware(BaseMiddleware):
    """Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏."""
    
    async def __call__(self, handler, event, data):
        """
        –û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ.
        
        Args:
            handler: –°–ª–µ–¥—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ —Ü–µ–ø–æ—á–∫–µ
            event: –°–æ–±—ã—Ç–∏–µ (Message –∏–ª–∏ CallbackQuery)
            data: –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è handler –∏–ª–∏ None –µ—Å–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
        """
        user_id = event.from_user.id
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        if not await self._is_user_authorized(user_id):
            await self._handle_unauthorized_user(event)
            return None
        
        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
        return await handler(event, data)
```

**–ü–æ–¥–∫–ª—é—á–∞–µ–º middleware:**

```python
# handler/include_middlewares.py
from .middleware import RegisterMiddleware, LargeMessageMiddleware, ErrorMiddleware
from handler.v1 import dp

dp.message.middleware(ErrorMiddleware())
dp.callback_query.middleware(ErrorMiddleware())
dp.message.middleware(RegisterMiddleware())
dp.callback_query.middleware(RegisterMiddleware())
dp.message.middleware(LargeMessageMiddleware())
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–∞–∫–µ—Ç `handler` - —ç—Ç–æ —Å–ª–æ–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π:
- üéØ **–°–æ–±–∏—Ä–∞–µ—Ç** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏–∑ `node/` –≤ —Ä–∞–±–æ—á–∏–µ –≤–∏–¥–∂–µ—Ç—ã
- üìã **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç** –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π Telegram
- üîÑ **–ù–µ –¥—É–±–ª–∏—Ä—É–µ—Ç** –ª–æ–≥–∏–∫—É - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- üìñ **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç** –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ Answer –∏ –ø–µ—Ä–µ—Ö–æ–¥—ã

**–ü—Ä–∞–≤–∏–ª–æ:** –í–∏–¥–∂–µ—Ç –≤ `handler/` —Ç–æ–ª—å–∫–æ –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç, –≤—Å—è –ª–æ–≥–∏–∫–∞ –≤ `node/`.
